<!DOCTYPE html>
<html lang="en">
<head>
    <title>Test Tube Color Detection App</title>
</head>
<body>
    <h1>Test Tube Color Detection App</h1>
    <input type="file" id="inputImage" accept="image/*">
    <canvas id="originalCanvas"></canvas>
    <canvas id="filteredCanvas"></canvas>

    <div id="colorOutput"></div>

    <script>
        const inputImage = document.getElementById('inputImage');
        const originalCanvas = document.getElementById('originalCanvas');
        const filteredCanvas = document.getElementById('filteredCanvas');
        const colorOutput = document.getElementById('colorOutput');

        inputImage.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        originalCanvas.width = img.width;
                        originalCanvas.height = img.height;
                        filteredCanvas.width = img.width;
                        filteredCanvas.height = img.height;

                        const ctxOriginal = originalCanvas.getContext('2d');
                        const ctxFiltered = filteredCanvas.getContext('2d');
                        
                        // Clear the filtered canvas
                        ctxFiltered.clearRect(0, 0, filteredCanvas.width, filteredCanvas.height);
                        
                        // Draw the original image onto the original canvas
                        ctxOriginal.drawImage(img, 0, 0);

                        const imageData = ctxOriginal.getImageData(0, 0, img.width, img.height);
                        const data = imageData.data;

                        // Initialize an array to store the color outputs
                        let colorList = [];
                        let tubeCount = 1;

                        // This will store the regions of detected colors
                        let regions = [];

                        // Loop through each pixel to detect pink and yellow and group regions
                        for (let i = 0; i < data.length; i += 4) {
                            const r = data[i];
                            const g = data[i + 1];
                            const b = data[i + 2];

                            // Check for pink (high red and blue, low green)
                            if (r > 150 && g < 100 && b > 150) {
                                // Mark the region as pink
                                regions.push({ index: i, color: 'pink' });
                                data[i] = 255;   // Red
                                data[i + 1] = 0; // Green
                                data[i + 2] = 255; // Blue (pure pink)
                            }
                            // Check for yellow (high red and green, low blue)
                            else if (r > 150 && g > 150 && b < 100) {
                                // Mark the region as yellow
                                regions.push({ index: i, color: 'yellow' });
                                data[i] = 255;   // Red
                                data[i + 1] = 255; // Green
                                data[i + 2] = 0; // Blue (pure yellow)
                            }
                        }

                        // Group the regions by color and eliminate duplicates
                        let colorCounts = { pink: 0, yellow: 0 };

                        // Iterate through the regions and count each color's occurrences
                        regions.forEach(region => {
                            colorCounts[region.color]++;
                        });

                        // Output only one result per tube based on the majority color detected
                        if (colorCounts.pink > colorCounts.yellow) {
                            colorList.push(`${tubeCount}. pink`);
                        } else if (colorCounts.yellow > colorCounts.pink) {
                            colorList.push(`${tubeCount}. yellow`);
                        }

                        // Put the filtered image onto the second canvas
                        ctxFiltered.putImageData(imageData, 0, 0);

                        // Output the color list as text
                        colorOutput.innerHTML = "<h2>Detected Test Tubes Colors:</h2><ol>" + 
                            colorList.map(item => `<li>${item}</li>`).join('') + 
                            "</ol>";
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
    </script>
</body>
</html>
